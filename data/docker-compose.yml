#version: '3.8'

services:
  TS:
    image: jaeyong0212/road_infra_videoprocessing_test:ver.1
    container_name: ts_container
    networks:
      macvlan_net:
        ipv4_address: 192.168.10.122
    restart: unless-stopped
    volumes:
      - /home/keti/jetson-containers/data:/data
    command: ["bash", "/data/YOLOv8_TS/run_v8_TS.sh"]
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

  TL:
    image: jaeyong0212/road_infra_videoprocessing_test:ver.1
    container_name: tl_container
    networks:
      macvlan_net:
        ipv4_address: 192.168.10.123
    restart: unless-stopped        
    volumes:
      - /home/keti/jetson-containers/data:/data
    command: ["bash", "/data/YOLOv8_TL/run_v8_TL.sh"]
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

  VMS:
    image: jaeyong0212/road_infra_videoprocessing_test:ver.1
    container_name: vms_container
    networks:
      macvlan_net:
        ipv4_address: 192.168.10.124
    volumes:
      - /home/keti/jetson-containers/data:/data
    command: ["bash", "/data/YOLOv8_VMS/run_v8_VMS.sh"]
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
            
  LCS:
    image: jaeyong0212/road_infra_videoprocessing_test:ver.1
    container_name: lcs_container
    networks:
      macvlan_net:
        ipv4_address: 192.168.10.125
    volumes:
      - /home/keti/jetson-containers/data:/data
    command: ["bash", "/data/YOLOv8_LCS/run_v8_LCS.sh"]
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

networks:
  macvlan_net:
    driver: macvlan
    external: true
    